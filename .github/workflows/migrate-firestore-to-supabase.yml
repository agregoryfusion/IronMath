name: Migrate Firestore to Supabase (one-time)

on:
  workflow_dispatch: {}

jobs:
  migrate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Create clean migration script + package.json
        shell: bash
        run: |
          set -euo pipefail
          rm -rf scripts
          mkdir -p scripts

          cat > scripts/package.json <<'EOF'
          {
            "name": "ironmath-firestore-migration",
            "private": true,
            "type": "commonjs",
            "dependencies": {
              "@google-cloud/firestore": "^7.10.0",
              "
